<htmlform formName="Mental Health eMastercard" formUuid="38A60208-3227-4CE7-AB2A-5802F8866BD4"
          formEncounterType="3F94849C-F245-4593-BCC8-879EAEA29168" formVersion="1.1">

    <style>
        .section-container input[type="checkbox"] {
            margin: 0px 5px; /*changed values to vertical, horizontal*/
            top:5px; /*added to offset the checkbox position to line up*/
        }
    </style>
    <macros>
        yesAnswer=PIH Malawi:1065
        noAnswer=PIH Malawi:1066
        positive=PIH Malawi:703
        negative=PIH Malawi:664
        unknown=PIH Malawi:1067
        other=PIH Malawi:5622
        noncodedOtherName=PIH Malawi:8575

        diagnosisSet=PIH Malawi:8445
        chronicCareDiagnosis=PIH Malawi:3683
        diagnosisDate=PIH Malawi:6774
        schizo=PIH Malawi:467
        depression=PIH Malawi:207
        acutePsychotic=PIH Malawi:8419
        schizoaffectiveDisorder=PIH Malawi:8487
        anxiety=PIH Malawi:2719
        acuteOrganicMentalDisorder=PIH Malawi:8488
        chronicOrganicMentalDisorder=PIH Malawi:8489
        alcoholUseMentalDisorder=PIH Malawi:8562
        drugUseMentalDisorder=PIH Malawi:8563
        manic=PIH Malawi:8491
        mentalHealthOther0=PIH Malawi:8420
        mentalHealthOther1=PIH Malawi:8580
        mentalHealthOther2=PIH Malawi:8581
        stressReact=PIH Malawi:8585
        dissoc=PIH Malawi:8586
        somato=PIH Malawi:8587
        puerp=PIH Malawi:8588
        personality=PIH Malawi:8589
        retardation=PIH Malawi:8590
        psychDev=PIH Malawi:8591
        hyper=PIH Malawi:8592

        mentalFamilyHistory=PIH Malawi:8458
        epilepsyFamilyHistory=PIH Malawi:8484
        mentalIllFamilyHistory=PIH Malawi:8485
        behaviorFamilyHistory=PIH Malawi:8486

        hivStatus=PIH Malawi:3753
        reactive=PIH Malawi:1228
        nReactive=PIH Malawi:1229
        hivTestDate=PIH Malawi:1837
        artStartDate=PIH Malawi:2516
        tbStatus=PIH Malawi:7459
        smearPos=PIH Malawi:2185
        smearNeg=PIH Malawi:2186
        eptb=PIH Malawi:1547
        tbYear=PIH Malawi:8453

        chiefCompAnswer=PIH Malawi:8569
        chiefCompConstruct=PIH Malawi:8570
        hallucinate=PIH Malawi:8564
        delusion=PIH Malawi:8565
        disrupt=PIH Malawi:8566
        abSpeech=PIH Malawi:8567
        depressive=PIH Malawi:8568

        patientPhone=PIH Malawi:1426
        guardianName=PIH Malawi:1824
        guardianPhone=PIH Malawi:2616
        relationToPatient=PIH Malawi:1328
        agreesToFollowup=PIH Malawi:2552
        chwName=PIH Malawi:8431

        exposure=PIH Malawi:8495
        exposeHistory=PIH Malawi:8571
        alcoholHistory=PIH Malawi:1552
        past=PIH Malawi:1548
        current=PIH Malawi:1550
        expoYears=PIH Malawi:2241
        expoDate=PIH Malawi:8545
        alcoholConstruct=PIH Malawi:2242
        mjConstruct=PIH Malawi:8574
        medsOtherConstruct=PIH Malawi:8576
        tradMedsConstruct=PIH Malawi:8573


    </macros>

    <span style="display:none">
        <encounterProvider default="16576"/><!-- Set provider to a default as not used -->
        <span id="patientBirthdate">
            <lookup expression="patient.birthdate"/>
        </span>
    </span>
    <div class="section-container">
        <h4 style="font-style: italic;">
            <b>NCD Patient Card</b>
            <b style="padding-left:50px;">Mental Health</b>
            <span style="padding-left:50px;">Version 1</span>

            <span style="padding-left:50px;">
                <b style="padding-right:10px;">
                    <encounterLocation id="mastercardLocation"/>
                    <span style="padding-left:20px;">
                        Date:
                        <encounterDate/>
                        <font color="red">*</font>
                    </span>
                </b>
            </span>

            <span style="padding-left:50px;">
                <b style="padding-right:10px;">NCD Reg no:</b>
                <b>
                    <lookup complexExpression="#foreach( $id in $patientIdentifiers.get(&quot;Chronic Care Number&quot;) ) $!id #end"/>
                </b>
            </span>
        </h4>
        <table class="data-entry-table">
            <tr style="border: none;">
                <td style="vertical-align:top;">
                    <h5>Patient / Guardian Details</h5>
                    <table>
                        <tr>
                            <td>Patient Name</td>
                            <td>
                                <lookup expression="patient.personName"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Sex, DOB</td>
                            <td>
                                <span class="left-cell">
                                    <lookup expression="patient.gender"/>
                                </span>
                                <span class="right-cell">
                                    <lookup expression="patient.birthdate"/>
                                    (Age:<lookup expression="patient.age"/>)
                                </span>
                            </td>
                        </tr>
                        <!-- Not on the latest version
                            occupation=1304
                            civilStatus=1054
                            religion=8482
                            educationLevel=1688
                        <tr>
                            <td>Occupation</td>
                            <td>
                                <obs conceptId="$occupation"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Marital status</td>
                            <td>
                                <obs conceptId="$civilStatus"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Religion</td>
                            <td>
                                <obs conceptId="$religion"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Education level</td>
                            <td>
                                <obs conceptId="$educationLevel"/>
                            </td>
                        </tr>
                        -->
                        <tr>
                            <td>Physical Address</td>
                            <td><!-- style="height:60px;" -->
                                <lookup complexExpression="#foreach( $addr in $patient.addresses) $!addr.getAddress1() $!addr.getCityVillage() $!addr.getStateProvince() $!addr.getCountyDistrict(), #end"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Patient Phone</td>
                            <td>
                                <obs conceptId="$patientPhone" size="10"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Guardian Name</td>
                            <td>
                                <obs id="guardianNameField" conceptId="$guardianName" size="40"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Guardian Phone</td>
                            <td>
                                <obs conceptId="$guardianPhone" size="10"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Guardian relation to patient</td>
                            <td>
                                <obs conceptId="$relationToPatient" size="10"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Agrees to FUP</td>
                            <td>
                                <obs conceptId="$agreesToFollowup" style="radio" answerLabels="N,Y"
                                     answerConceptIds="$noAnswer,$yesAnswer"/>
                            </td>
                        </tr>
                        <tr>
                            <td>CHW Name</td>
                            <td>
                                <obs conceptId="$chwName"/>
                            </td>
                        </tr>
                    </table>
                </td>

                <td style="vertical-align:top;">
                    <h5>Patient Overview</h5>
                    <table>
                        <tr>
                            <th style="vertical-align:top;" align="left" rowspan="13">Diagnoses</th>

                                <obsgroup groupingConceptId="$diagnosisSet">
                                    <td data-toggle-source="schizo" data-toggle-target="schizo-date" style="border-right: 1px solid #ffffff;">
                                        <obs conceptId="$chronicCareDiagnosis" style="checkbox"
                                             answerConceptId="$schizo" answerLabel="Schizophrenia"/>
                                    </td>
                                    <td id="schizo-date" style="border-left: 1px solid #ffffff;">
                                        <obs conceptId="$diagnosisDate" labelText="Date"/>
                                    </td>
                                </obsgroup>

                            <!-- Family History -->
                            <th style="vertical-align:top;" align="left" rowspan="13">
                                Family<br/>History
                            </th>
                            <td style="vertical-align:top;" rowspan="13">
                                <obs conceptId="$epilepsyFamilyHistory" answerLabel="Epilepsy"
                                     answerConceptId="$yesAnswer" style="checkbox"/>
                                <br/><br/>
                                <obs conceptId="$mentalIllFamilyHistory" answerLabel="Mental illness"
                                     answerConceptId="$yesAnswer" style="checkbox"/>
                                <br/><br/>
                                <obs conceptId="$behaviorFamilyHistory" answerLabel="Behavioral problems"
                                     answerConceptId="$yesAnswer" style="checkbox"/>
                            </td>
                        </tr>
                                    <!-- Mental Health diagnoses -->
                                    <repeat with="['$manic','Mood affective disorder (manic)','manic'],
                                        ['$depression','Mood affective disorder (depression)','depress'],
                                        ['$acutePsychotic','Acute &#38; transient psychotic disorder','transient'],
                                        ['$schizoaffectiveDisorder','Schizoaffective Disorder','schizoaff'],
                                        ['$anxiety','Anxiety disorder','anxiety'],
                                        ['$acuteOrganicMentalDisorder','Organic mental disorder (acute)','organic-acute'],
                                        ['$chronicOrganicMentalDisorder','Organic mental disorder (chronic)','organic-chronic'],
                                        ['$drugUseMentalDisorder','Drug use mental disorder','drug'],
                                        ['$alcoholUseMentalDisorder','Alcohol use mental disorder','booze']">

                                        <tr>
                                            <obsgroup groupingConceptId="$diagnosisSet">
                                                <td data-toggle-source="{2}" data-toggle-target="{2}-date" style="border-right: 1px solid #ffffff;">
                                                    <obs conceptId="$chronicCareDiagnosis" style="checkbox"
                                                         answerConceptId="{0}" answerLabel="{1}"/>
                                                </td>
                                                <td id="{2}-date" style="border-left: 1px solid #ffffff;">
                                                    <obs conceptId="$diagnosisDate" labelText="Date"/>
                                                </td>
                                            </obsgroup>
                                        </tr>
                                    </repeat>

                        <!-- todo: Add other diagnoses -->
                        <repeat with="['$mentalHealthOther0','Other,','other1'],
                                      ['$mentalHealthOther1','Other,','other2']">

                            <tr>
                                <obsgroup groupingConceptId="$diagnosisSet">
                                    <td data-toggle-source="{2}" data-toggle-target="{2}-date"
                                        style="border-right: 1px solid #ffffff;">
                                        <obs conceptId="$chronicCareDiagnosis" style="checkbox"
                                             answerConceptId="{0}" answerLabel="{1}"/>
                                        <obs conceptId="$noncodedOtherName" />
                                    </td>
                                    <td id="{2}-date" style="border-left: 1px solid #ffffff;">
                                        <obs conceptId="$diagnosisDate" labelText="Date"/>
                                    </td>
                                </obsgroup>
                            </tr>
                        </repeat>

                        <tr>
                            <obsgroup groupingConceptId="$diagnosisSet">

                                <td style="border-right: 1px solid #ffffff;">
                                    Other:
                                    <obs conceptId="$chronicCareDiagnosis"
                                         answerConceptIds="$stressReact,$dissoc,$puerp,$personality,$retardation,$psychDev,$hyper"
                                         answerLabels="Stress reaction disorder,Dissociative disorder,Somatoform disorder,Puerperal disorder,Mental retardation,Psych development disorder,Hyperkinetic behavior"/>
                                </td>
                                <td style="border-left: 1px solid #ffffff;">
                                    <!-- ToDo:  Capture date but it doesn't work when there's no
                                         other coded concept selected.  It shows up in the wrong
                                         place.
                                    <obs conceptId="$diagnosisDate" labelText="Date"/>
                                    -->
                                </td>
                            </obsgroup>
                        </tr>

                        <tr>
                            <th style="vertical-align:top;" align="left" rowspan="8">Patient<br/>History &#38;<br/>
                                Exposures
                            </th>
                            <td class="nowrap">
                                <strong>HIV</strong>
                                <obs conceptId="$hivStatus"
                                     answerConceptIds="$reactive,$nReactive,$unknown"/>
                                <br/>
                                <obs conceptId="$hivTestDate" labelText="Date test"/>
                            </td>
                            <td>
                                <strong>ART</strong><br/>
                                <obs conceptId="$artStartDate" labelText="Start Date"/>
                            </td>
                            <td class="nowrap" style="border-right: 1px solid #ffffff;">
                                <strong>TB</strong>
                                <obs conceptId="$tbStatus"
                                     answerConceptIds="$smearPos,$smearNeg,$eptb,$unknown"
                                     answerLabels="smear pos,smear neg,EPTB,never had TB"/>
                            </td>
                            <td style="border-left: 1px solid #ffffff;">
                                <obs conceptId="$tbYear" labelText="Year"/>
                            </td>
                        </tr>

                        <tr>
                            <th style="vertical-align:top;" align="left" colspan="2">
                                Presenting Features
                            </th>
                            <td rowspan="2" colspan="2" style="padding: 0px;">
                                <obsgroup groupingConceptId="$alcoholConstruct">
                                <table border="0" cellpadding="0" cellspacing="0" width="100%">
                                    <tr>
                                        <td style="border: 1px solid #ffffff;">
                                            <strong>Alcohol</strong>
                                        </td>
                                        <td style="border: 1px solid #ffffff;">
                                            <obs conceptId="$alcoholHistory" style="checkbox"
                                                 answerConceptId="$current" answerLabel="Current"/>
                                            <obs conceptId="$alcoholHistory" style="checkbox"
                                                 answerConceptId="$past" answerLabel="Past"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2" style="border: 1px solid #ffffff;">
                                            <obs conceptId="$expoYears" labelText="# years"/>
                                            &amp;nbsp;&amp;nbsp;&amp;nbsp;
                                            <obs conceptId="$expoDate" labelText="Date last use"/>
                                        </td>
                                    </tr>
                                </table>
                                </obsgroup>
                            </td>
                        </tr>
                        <tr>
                            <obsgroup groupingConceptId="$chiefCompConstruct">
                                <td data-toggle-source="hallu" data-toggle-target="hallu-date" style="border-right: 1px solid #ffffff;">
                                    <obs conceptId="$chiefCompAnswer" style="checkbox"
                                         answerConceptId="$hallucinate" answerLabel="Hallucinations"/>
                                </td>
                                <td id="hallu-date" style="border-left: 1px solid #ffffff;">
                                    <obs conceptId="$diagnosisDate" labelText="Date"/>
                                </td>
                            </obsgroup>
                        </tr>
                        <tr>
                            <obsgroup groupingConceptId="$chiefCompConstruct">
                                <td data-toggle-source="delu" data-toggle-target="delu-date" style="border-right: 1px solid #ffffff;">
                                    <obs conceptId="$chiefCompAnswer" style="checkbox"
                                         answerConceptId="$delusion" answerLabel="Delusions"/>
                                </td>
                                <td id="delu-date" style="border-left: 1px solid #ffffff;">
                                    <obs conceptId="$diagnosisDate" labelText="Date"/>
                                </td>
                            </obsgroup>
                            <td rowspan="2" colspan="2" style="padding: 0px;">
                                <obsgroup groupingConceptId="$mjConstruct">
                                    <table border="0" cellpadding="0" cellspacing="0" width="100%">
                                        <tr>
                                            <td style="border: 1px solid #ffffff;">
                                                <strong>Chamba</strong><br/>
                                                <small>(Marijuana)</small>
                                            </td>
                                            <td style="border: 1px solid #ffffff;">
                                                <obs conceptId="$exposeHistory" style="checkbox"
                                                     answerConceptId="$current" answerLabel="Current"/>
                                                <obs conceptId="$exposeHistory" style="checkbox"
                                                     answerConceptId="$past" answerLabel="Past"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2" id="mj-time" style="border: 1px solid #ffffff;">
                                                <obs conceptId="$expoYears" labelText="# years"/>
                                                &amp;nbsp;&amp;nbsp;&amp;nbsp;
                                                <obs conceptId="$expoDate" labelText="Date last use"/>
                                            </td>
                                        </tr>
                                    </table>
                                </obsgroup>
                            </td>
                        </tr>

                        <tr>
                            <obsgroup groupingConceptId="$chiefCompConstruct">
                                <td data-toggle-source="disrupt" data-toggle-target="disrupt-date" style="border-right: 1px solid #ffffff;">
                                    <obs conceptId="$chiefCompAnswer" style="checkbox"
                                         answerConceptId="$disrupt" answerLabel="Disorganised/disruptive behaviour"/>
                                </td>
                                <td id="disrupt-date" style="border-left: 1px solid #ffffff;">
                                    <obs conceptId="$diagnosisDate" labelText="Date"/>
                                </td>
                            </obsgroup>
                        </tr>
                        <tr>
                            <obsgroup groupingConceptId="$chiefCompConstruct">
                                <td data-toggle-source="abspeech" data-toggle-target="abspeech-date" style="border-right: 1px solid #ffffff;">
                                    <obs conceptId="$chiefCompAnswer" style="checkbox"
                                         answerConceptId="$abSpeech" answerLabel="Disorganised speech"/>
                                </td>
                                <td id="abspeech-date" style="border-left: 1px solid #ffffff;">
                                    <obs conceptId="$diagnosisDate" labelText="Date"/>
                                </td>
                            </obsgroup>

                            <td rowspan="2" colspan="2" style="padding: 0px;">
                                <obsgroup groupingConceptId="$medsOtherConstruct">
                                    <table border="0" cellpadding="0" cellspacing="0" width="100%">
                                        <tr>
                                            <td style="border: 1px solid #ffffff;">
                                                <strong>Other drugs</strong>
                                                <br/>
                                                <obs conceptId="$noncodedOtherName" />
                                            </td>
                                            <td style="border: 1px solid #ffffff;">
                                                <obs conceptId="$exposeHistory" style="checkbox"
                                                     answerConceptId="$current" answerLabel="Current"/>
                                                <obs conceptId="$exposeHistory" style="checkbox"
                                                     answerConceptId="$past" answerLabel="Past"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2" id="other-meds-time" style="border: 1px solid #ffffff;">
                                                <obs conceptId="$expoYears" labelText="# years"/>
                                                &amp;nbsp;&amp;nbsp;&amp;nbsp;
                                                <obs conceptId="$expoDate" labelText="Date last use"/>
                                            </td>
                                        </tr>
                                    </table>
                                </obsgroup>
                            </td>
                        </tr>

                        <tr>
                            <obsgroup groupingConceptId="$chiefCompConstruct">
                                <td data-toggle-source="depr" data-toggle-target="depr-date"
                                    style="border-right: 1px solid #ffffff;">
                                    <obs conceptId="$chiefCompAnswer" style="checkbox"
                                         answerConceptId="$depressive" answerLabel="Depressive symptoms"/>
                                </td>
                                <td id="depr-date" style="border-left: 1px solid #ffffff;">
                                    <obs conceptId="$diagnosisDate" labelText="Date"/>
                                </td>
                            </obsgroup>
                        </tr>
                        <tr>
                            <obsgroup groupingConceptId="$chiefCompConstruct">
                                <td data-toggle-source="other-chief" data-toggle-target="o-date"
                                    style="border-right: 1px solid #ffffff;">
                                    <obs conceptId="$chiefCompAnswer" style="checkbox"
                                         answerConceptId="$other" answerLabel="Other,"
                                         commentFieldLabel="specify" />
                                </td>
                                <td id="o-date" style="border-left: 1px solid #ffffff;">
                                    <obs conceptId="$diagnosisDate" labelText="Date"/>
                                </td>
                            </obsgroup>
                            <td rowspan="2" colspan="2" style="padding: 0px;">
                                <obsgroup groupingConceptId="$tradMedsConstruct">
                                    <table cellpadding="0" cellspacing="0" width="100%">
                                        <tr>
                                            <td style="border: 1px solid #ffffff;">
                                                <strong>Traditional<br/>medicine</strong>
                                            </td>
                                            <td style="border: 1px solid #ffffff;">
                                                <obs conceptId="$exposeHistory" style="checkbox"
                                                     answerConceptId="$current" answerLabel="Current"/>
                                                <obs conceptId="$exposeHistory" style="checkbox"
                                                     answerConceptId="$past" answerLabel="Past"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2" id="trad-time" style="border: 1px solid #ffffff;">
                                                <obs conceptId="$expoYears" labelText="# years"/>
                                                &amp;nbsp;&amp;nbsp;&amp;nbsp;
                                                <obs conceptId="$expoDate" labelText="Date last use"/>
                                            </td>
                                        </tr>
                                    </table>
                                </obsgroup>
                            </td>
                        </tr>

                        <tr>
                            <th style="vertical-align:top;" align="left" colspan="3">Outcome:
                                    <lookup expression="fn.currentProgramWorkflowStatus(16).state.concept.name"/>
                                    (<lookup expression="fn.currentProgramWorkflowStatus(16).startDate"/>)
                            </th>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
        <ifMode mode="VIEW" include="false">
            <div id="buttons" style="margin-top:10px;">
                <button class="submitButton confirm" onclick="submitHtmlForm()">
                    <uimessage code="uicommons.save"/>
                    <i class="icon-spinner icon-spin icon-2x" style="display: none; margin-left: 10px;"></i>
                </button>
            </div>
        </ifMode>
    </div>
</htmlform>