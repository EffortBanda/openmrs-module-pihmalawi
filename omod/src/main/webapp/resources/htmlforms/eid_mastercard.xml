<htmlform formUuid="f341dc7a-f06f-4d0c-b9d5-fddf147ae1ed" 
          formName="Exposed Child eMastercard"
          formEncounterType="664bcbb0-977f-11e1-8993-905e29aff6c1"
          formVersion="1.0">

    <macros>
        agreesToFollowup=PIH Malawi:2552
        noAnswer=PIH Malawi:1066
        yesAnswer=PIH Malawi:1065
        none=PIH Malawi:1107
        guardianName=PIH Malawi:1824
        guardianPhone=PIH Malawi:3294
        guardianRelation=PIH Malawi:1826

        <!-- Version 1
        arvsInPreg=PIH Malawi:8169
        arvsInLabour=PIH Malawi:8182
        arvsAtBirth=PIH Malawi:8186
        arvsContd=PIH Malawi:8187
        adherence=PIH Malawi:2681
        deliveryLocation=PIH Malawi:3452
        hivStatus=PIH Malawi:5303
        -->

        azt03=PIH Malawi:8173
        azt4p=PIH Malawi:8174
        art03=PIH Malawi:8175
        art4p=PIH Malawi:8176
        unknown=PIH Malawi:1067
        sdNVP=PIH Malawi:8178
        AZT3TC=PIH Malawi:8179
        NVPAZT3TC=PIH Malawi:8180
        ART=PIH Malawi:8181
        Nevirapine=PIH Malawi:631
        NVPAZT2=PIH Malawi:8184
        Zidovudine=PIH Malawi:797

        startAgeNVP=PIH Malawi:8556
        nvpDuration=PIH Malawi:8559
        durationUnits=PIH Malawi:8557
        medDuration=PIH Malawi:8558
        days=PIH Malawi:1072
        weeks=PIH Malawi:1073
        months=PIH Malawi:1074
        years=PIH Malawi:2287

        enrollmentAge=PIH Malawi:3467
        hivRapid=PIH Malawi:1040
        notDone=PIH Malawi:1118
        negative=PIH Malawi:664
        positive=PIH Malawi:703
        inconclusive=PIH Malawi:1138
        hivPCR=PIH Malawi:844
        notConfirmed=PIH Malawi:8045
        confirmed=PIH Malawi:6250
        motherHIVStatus=PIH Malawi:8036
        aliveNotOnART=PIH Malawi:8037
        aliveOnART=PIH Malawi:8038
        patientDied=PIH Malawi:1742
        suspectedHIVExposure=PIH Malawi:1062
        motherRegNo=PIH Malawi:8046
        motherARTstart=PIH Malawi:3586
        hivTestConstruct=PIH Malawi:PIH Malawi:2168
        hivTestType=PIH Malawi:PIH Malawi:1867
        hivResult=PIH Malawi:PIH Malawi:2169
        hivSampleDate=PIH Malawi:PIH Malawi:6108
        labTestNumber=PIH Malawi:PIH Malawi:3564
        hivResultDate=PIH Malawi:PIH Malawi:6110
        period=PIH Malawi:8554
        setAge=PIH Malawi:8550
        unitAge=PIH Malawi:2286
        dateToGuardian=PIH Malawi:8549
        birthWeight=PIH Malawi:5916
    </macros>

    <span style="display:none">
        <encounterProvider default="16576" />
        <span id="patientBirthdate"><lookup expression="patient.birthdate"/></span>
    </span> <!-- Set provider to a default as not used -->
    <div>
        <h4 style="font-style: italic;">
            <b>Exposed Child Under 24 Months</b>
            <span style="padding-left:50px;">Version 1</span>
            <span style="padding-left:50px;">
                <b style="padding-right:10px;">HCC no: </b>
                <b>
                    <lookup complexExpression="#foreach( $id in $patientIdentifiers.get(&quot;HCC Number&quot;) ) $!id #end" />
                </b>
            </span>
        </h4>
        <table class="data-entry-table">
            <tr style="border: none;">
                <td style="vertical-align:top;">
                    <h5>Child and Guardian Details</h5>
                    <table>
                        <tr>    
                            <td>Child Name</td>
                            <td>
                                <span class="left-cell">
                                    <lookup expression="patient.personName" />
                                </span>
                                <span class="left-cell">
                                    <lookup expression="patient.gender" />
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td>Guardian Name</td>
                            <td>
                                <obs id="guardianNameField" conceptId="$guardianName" size="40"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Physical Address</td>
                            <td>
                                <lookup complexExpression="#foreach( $addr in $patient.addresses) $!addr.getAddress1() $!addr.getCityVillage() $!addr.getStateProvince() $!addr.getCountyDistrict(), #end" />
                            </td>
                        </tr>
                        <tr>
                            <td>Agrees to FUP</td>
                            <td>
                                <obs conceptId="$agreesToFollowup" style="radio" answerLabels="N,Y" answerConceptIds="$noAnswer,$yesAnswer" />
                            </td>
                        </tr>                       
                        <tr>
                            <td>Guardian Relation</td>
                            <td>
                                <obs conceptId="$guardianRelation" size="10" />
                            </td>
                        </tr>                           
                        <tr>
                            <td>Guardian Phone</td>
                            <td>
                                <obs conceptId="$guardianPhone" size="10"/>
                            </td>
                        </tr>                       
                    </table>
                </td>

                <td style="vertical-align:top;">
                    <h5>Status at Enrolment</h5>
                    <table>
                        <tr>
                            <td rowspan="2">Mother</td>
                            <td>Status</td>
                            <td colspan="2">
                                <obs conceptId="$motherHIVStatus"
                                     style="radio" answerConceptIds="$aliveNotOnART,$aliveOnART,$patientDied,$suspectedHIVExposure"
                                     answerLabels="NoART, OnART, Died, Unk" />
                            </td>
                        </tr>
                        <tr>
                            <td>ART</td>
                            <td><obs conceptId="$motherRegNo" labelText="RegNo" /></td>
                            <td><obs conceptId="$motherARTstart" labelText="Start date"/></td>
                        </tr>
                        <tr>
                            <td rowspan="2">Child</td>
                            <td>Age</td>
                            <td>
                                At Enrolment<br/>
                                    <obs conceptId="$enrollmentAge"/> weeks
                            </td>
                            <td>
                                When starting NVP<br/>
                                <obsgroup groupingConceptId="$startAgeNVP">
                                    <obs conceptId="$setAge"/>
                                    <!-- ToDo:  Checking with Malawi -->
                                    <obs conceptId="$unitAge"
                                         answerConceptIds="$weeks,$months"
                                         defaultValue="$weeks" />
                                </obsgroup>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                NVP duration
                            </td>
                            <td colspan="2">
                                <obsgroup groupingConceptId="$nvpDuration">
                                    <obs conceptId="$medDuration"/>

                                    <!-- ToDo: Duration units is weeks and months. -->
                                    <obs conceptId="$durationUnits"
                                         answerConceptIds="$weeks,$months"
                                         defaultValue="$weeks" />
                                </obsgroup>

                            </td>
                        </tr>
                    </table>
                </td>

                <td style="vertical-align:top;">
                <h5>HIV Testing</h5>
                <table>
                    <tr>
                        <td>Sample Date</td>
                        <td>Type</td>
                        <td>Sample ID /<br/>HTC Serial No</td>
                        <td>Result</td>
                        <td>Date received<br/>from lab</td>
                    </tr>
                    <tr>
                        <obsgroup groupingConceptId="$hivTestConstruct">
                            <td><obs conceptId="$hivSampleDate"/></td>
                            <td><obs conceptId="$hivTestType" answerConceptIds="$hivPCR,$hivRapid"
                                     answerLabels="DBS,RT" style="radio"/></td>
                            <td><obs conceptId="$labTestNumber" /></td>
                            <td><obs conceptId="$hivResult"
                                     answerConceptIds="$negative,$positive,$inconclusive"
                                     answerLabels="Neg,Pos,Inc"
                                     style="radio" /></td>
                            <td><obs conceptId="$hivResultDate" /></td>
                        </obsgroup>
                    </tr>
                    <tr>
                        <obsgroup groupingConceptId="$hivTestConstruct">
                            <td><obs conceptId="$hivSampleDate"/></td>
                            <td><obs conceptId="$hivTestType" answerConceptIds="$hivPCR,$hivRapid"
                                     answerLabels="DBS,RT" style="radio"/></td>
                            <td><obs conceptId="$labTestNumber" /></td>
                            <td><obs conceptId="$hivResult"
                                     answerConceptIds="$negative,$positive,$inconclusive"
                                     answerLabels="Neg,Pos,Inc"
                                     style="radio" /></td>
                            <td><obs conceptId="$hivResultDate" /></td>
                        </obsgroup>
                    </tr>
                    <tr>
                        <obsgroup groupingConceptId="$hivTestConstruct">
                            <td><obs conceptId="$hivSampleDate"/></td>
                            <td><obs conceptId="$hivTestType" answerConceptIds="$hivPCR,$hivRapid"
                                     answerLabels="DBS,RT" style="radio"/></td>
                            <td><obs conceptId="$labTestNumber" /></td>
                            <td><obs conceptId="$hivResult"
                                     answerConceptIds="$negative,$positive,$inconclusive"
                                     answerLabels="Neg,Pos,Inc"
                                     style="radio" /></td>
                            <td><obs conceptId="$hivResultDate" /></td>
                        </obsgroup>
                    </tr>
                    <tr>
                        <obsgroup groupingConceptId="$hivTestConstruct">
                            <td><obs conceptId="$hivSampleDate"/></td>
                            <td><obs conceptId="$hivTestType" answerConceptIds="$hivPCR,$hivRapid"
                                     answerLabels="DBS,RT" style="radio"/></td>
                            <td><obs conceptId="$labTestNumber" /></td>
                            <td><obs conceptId="$hivResult"
                                     answerConceptIds="$negative,$positive,$inconclusive"
                                     answerLabels="Neg,Pos,Inc"
                                     style="radio" /></td>
                            <td><obs conceptId="$hivResultDate" /></td>
                        </obsgroup>
                    </tr>
                </table>
                </td>
            </tr>
        </table>

        <hr/>
        <h2>Initiation and outcome</h2>
        <table class="data-entry-table">
        <tr>
            <td>
                Initiation Location<br/>
                <i>For Transfer-In, location of initial encounter</i>
            </td>
            <td>
                <encounterLocation id="mastercardLocation" />
            </td>
        </tr>
        <tr>
            <td>
                Initiation Date<br/>
                <i>For Transfer-In, date of initial encounter at initiation location</i>
            </td>
            <td>
                <encounterDate />
            </td>
        </tr>
        <tr>
            <td>
                Birth Date
            </td>
            <td>
                <lookup expression="patient.birthdate"/>
            </td>
        </tr>
        <tr>
            <td>
                Birth Wgt
            </td>
            <td>
                <obs conceptId="$birthWeight" showUnits="true" />
            </td>
        </tr>
        <tr>
            <td>Current outcome</td>
            <td>
                <lookup expression="fn.currentProgramWorkflowStatus(1).state.concept.name"/>
                (<lookup expression="fn.currentProgramWorkflowStatus(1).startDate"/>)
            </td>
        </tr>
    </table>

        <ifMode mode="VIEW" include="false">
            <div id="buttons" style="margin-top:10px;">
                <button class="submitButton confirm" onclick="submitHtmlForm()">
                    <uimessage code="uicommons.save"/>
                    <i class="icon-spinner icon-spin icon-2x" style="display: none; margin-left: 10px;"></i>
                </button>
            </div>
        </ifMode>
    </div>
</htmlform>