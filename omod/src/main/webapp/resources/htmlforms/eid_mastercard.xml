<htmlform formUuid="f341dc7a-f06f-4d0c-b9d5-fddf147ae1ed" 
          formName="Exposed Child eMastercard"
          formEncounterType="664bcbb0-977f-11e1-8993-905e29aff6c1"
          formVersion="1.0">

    <macros>
        agreesToFollowup=2552
        noAnswer=1066
        yesAnswer=1065
        none=1107
        guardianName=PIH Malawi:1824
        guardianPhone=3294
        guardianRelation=1826

        <!-- Version 1
        arvsInPreg=8169
        arvsInLabour=8182
        arvsAtBirth=8186
        arvsContd=8187
        adherence=2681
        deliveryLocation=3452
        hivStatus=5303
        -->

        azt03=8173
        azt4p=8174
        art03=8175
        art4p=8176
        unknown=1067
        sdNVP=8178
        AZT3TC=8179
        NVPAZT3TC=8180
        ART=8181
        Nevirapine=631
        NVPAZT2=8184
        Zidovudine=797

        startAgeNVP=8556
        enrollmentAge=8561
        nvpDuration=8559
        durationUnits=8557
        medDuration=8558
        days=1072
        weeks=1073
        months=1074
        years=2287

        age=3467
        hivRapid=1040
        notDone=1118
        negative=664
        positive=703
        inconclusive=1138
        hivPCR=844
        notConfirmed=8045
        confirmed=6250
        motherHIVStatus=8036
        aliveNotOnART=8037
        aliveOnART=8038
        patientDied=1742
        suspectedHIVExposure=1062
        motherRegNo=8046
        motherARTstart=3586
        hivTestConstruct=PIH Malawi:2168
        hivTestType=PIH Malawi:1867
        hivResult=PIH Malawi:2169
        hivSampleDate=PIH Malawi:6108
        labTestNumber=PIH Malawi:3564
        hivResultDate=PIH Malawi:6110

        <!-- Remove these after migration -->
        rapidSampleDateEnrolment=8068
        rapidSampleDateOne=8069
        rapidSampleDateTwo=8070
        rapidAgeEnrolment=8071
        rapidAgeOne=8072
        rapidAgeTwo=8073
        rapidHTCEnrolment=8074
        rapidHTCOne=8075
        rapidHTCTwo=8076
        rapidResultEnrolment=8077
        rapidResultOne=8078
        rapidResultTwo=8079
        dnaSampleDateEnrolment=8047
        dnaSampleDateOne=8048
        dnaSampleDateTwo=8049
        dnaSampleIDEnrolment=8050
        dnaSampleIDOne=8051
        dnaSampleIDTwo=8052
        dnaResultRcdDateEnrolment=8053
        dnaResultRcdDateOne=8054
        dnaResultRcdDateTwo=8055
        dnaResultEnrolment=8056
        dnaResultOne=8057
        dnaResultTwo=8058
        dnaResultGivenDateEnrolment=8059
        dnaResultGivenDateOne=8060
        dnaResultGivenDateTwo=8061
        dnaAgeEnrolment=8062
        dnaAgeOne=8063
        dnaAgeTwo=8064

        period=8554
        unitAge=2286
        dateToGuardian=8549
        birthWeight=5916
    </macros>

    <span style="display:none">
        <encounterProvider default="16576" />
        <span id="patientBirthdate"><lookup expression="patient.birthdate"/></span>
    </span> <!-- Set provider to a default as not used -->
    <div>
        <h4 style="font-style: italic;">
            <b>Exposed Child Under 24 Months</b>
            <span style="padding-left:50px;">Version 1</span>
            <span style="padding-left:50px;">
                <b style="padding-right:10px;">HCC no: </b>
                <b>
                    <lookup complexExpression="#foreach( $id in $patientIdentifiers.get(&quot;HCC Number&quot;) ) $!id #end" />
                </b>
            </span>
        </h4>
        <table class="data-entry-table">
            <tr style="border: none;">
                <td style="vertical-align:top;">
                    <h5>Child and Guardian Details</h5>
                    <table>
                        <tr>    
                            <td>Child Name</td>
                            <td>
                                <span class="left-cell">
                                    <lookup expression="patient.personName" />
                                </span>
                                <span class="left-cell">
                                    <lookup expression="patient.gender" />
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td>Guardian Name</td>
                            <td>
                                <obs id="guardianNameField" conceptId="$guardianName" size="40"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Physical Address</td>
                            <td>
                                <lookup complexExpression="#foreach( $addr in $patient.addresses) $!addr.getAddress1() $!addr.getCityVillage() $!addr.getStateProvince() $!addr.getCountyDistrict(), #end" />
                            </td>
                        </tr>
                        <tr>
                            <td>Agrees to FUP</td>
                            <td>
                                <obs conceptId="$agreesToFollowup" style="radio" answerLabels="N,Y" answerConceptIds="$noAnswer,$yesAnswer" />
                            </td>
                        </tr>                       
                        <tr>
                            <td>Guardian Relation</td>
                            <td>
                                <obs conceptId="$guardianRelation" size="10" />
                            </td>
                        </tr>                           
                        <tr>
                            <td>Guardian Phone</td>
                            <td>
                                <obs conceptId="$guardianPhone" size="10"/>
                            </td>
                        </tr>                       
                    </table>
                </td>

                <td style="vertical-align:top;">
                    <h5>Status at Enrolment</h5>
                    <table>
                        <tr>
                            <td rowspan="2">Mother</td>
                            <td>Status</td>
                            <td colspan="2">
                                <obs conceptId="$motherHIVStatus"
                                     style="radio" answerConceptIds="$aliveNotOnART,$aliveOnART,$patientDied,$suspectedHIVExposure"
                                     answerLabels="NoART, OnART, Died, Unk" />
                            </td>
                        </tr>
                        <tr>
                            <td>ART</td>
                            <td><obs conceptId="$motherRegNo" labelText="RegNo" /></td>
                            <td><obs conceptId="$motherARTstart" labelText="Start date"/></td>
                        </tr>
                        <tr>
                            <td rowspan="2">Child</td>
                            <td>Age</td>
                            <td>
                                At Enrolment<br/>
                                <obsgroup groupingConceptId="$enrollmentAge">
                                    <obs conceptId="$age"/>
                                    <obs conceptId="$unitAge" defaultValue="$days" answerConceptIds="$days,$weeks,$months,$years"/>
                                </obsgroup>
                            </td>
                            <td>
                                When starting NVP<br/>
                                <obsgroup groupingConceptId="$startAgeNVP">
                                    <obs conceptId="$age"/>
                                    <obs conceptId="$unitAge" defaultValue="$days" answerConceptIds="$days,$weeks,$months,$years"/>
                                </obsgroup>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                NVP duration
                            </td>
                            <td colspan="2">
                                <obsgroup groupingConceptId="$nvpDuration">
                                    <obs conceptId="$medDuration"/>
                                    <!-- TBD:
                                         What are the duration units?
                                         Mastercard doesn't allow defaultValue.
                                         We should we set a default duration unit -->
                                    <obs conceptId="$durationUnits" defaultValue="$months" />
                                </obsgroup>

                            </td>
                        </tr>
                    </table>
                </td>

                <td style="vertical-align:top;">
                <h5>HIV Testing</h5>
                <table>
                    <tr>
                        <td>Sample Date</td>
                        <td>Type</td>
                        <td>Sample ID /<br/>HTC Serial No</td>
                        <td>Result</td>
                        <td>Date received<br/>from lab</td>
                        <!-- For migration data testing -->
                        <td><i>Period</i></td>
                        <td><i>Age</i></td>
                        <td><i>Date to<br/>guardian</i></td>
                    </tr>
                    <tr>
                        <obsgroup groupingConceptId="$hivTestConstruct">
                            <td><obs conceptId="$hivSampleDate"/></td>
                            <td><obs conceptId="$hivTestType" answerConceptIds="$hivPCR,$hivRapid"
                                     answerLabels="DBS,RT" style="radio"/></td>
                            <td><obs conceptId="$labTestNumber" /></td>
                            <td><obs conceptId="$hivResult"
                                     answerConceptIds="$negative,$positive,$inconclusive"
                                     answerLabels="Neg,Pos,Inc"
                                     style="radio" /></td>
                            <td><obs conceptId="$hivResultDate" /></td>

                            <td><obs conceptId="$period"/></td>
                            <td><obs conceptId="$age"/> <obs conceptId="$unitAge"/> </td>
                            <td><obs conceptId="$dateToGuardian"/></td>
                        </obsgroup>
                    </tr>
                    <tr>
                        <obsgroup groupingConceptId="$hivTestConstruct">
                            <td><obs conceptId="$hivSampleDate"/></td>
                            <td><obs conceptId="$hivTestType" answerConceptIds="$hivPCR,$hivRapid"
                                     answerLabels="DBS,RT" style="radio"/></td>
                            <td><obs conceptId="$labTestNumber" /></td>
                            <td><obs conceptId="$hivResult"
                                     answerConceptIds="$negative,$positive,$inconclusive"
                                     answerLabels="Neg,Pos,Inc"
                                     style="radio" /></td>
                            <td><obs conceptId="$hivResultDate" /></td>

                            <td><obs conceptId="$period"/></td>
                            <td><obs conceptId="$age"/> <obs conceptId="$unitAge"/> </td>
                            <td><obs conceptId="$dateToGuardian"/></td>
                        </obsgroup>
                    </tr>
                    <tr>
                        <obsgroup groupingConceptId="$hivTestConstruct">
                            <td><obs conceptId="$hivSampleDate"/></td>
                            <td><obs conceptId="$hivTestType" answerConceptIds="$hivPCR,$hivRapid"
                                     answerLabels="DBS,RT" style="radio"/></td>
                            <td><obs conceptId="$labTestNumber" /></td>
                            <td><obs conceptId="$hivResult"
                                     answerConceptIds="$negative,$positive,$inconclusive"
                                     answerLabels="Neg,Pos,Inc"
                                     style="radio" /></td>
                            <td><obs conceptId="$hivResultDate" /></td>

                            <td><obs conceptId="$period"/></td>
                            <td><obs conceptId="$age"/> <obs conceptId="$unitAge"/> </td>
                            <td><obs conceptId="$dateToGuardian"/></td>
                        </obsgroup>
                    </tr>
                    <tr>
                        <obsgroup groupingConceptId="$hivTestConstruct">
                            <td><obs conceptId="$hivSampleDate"/></td>
                            <td><obs conceptId="$hivTestType" answerConceptIds="$hivPCR,$hivRapid"
                                     answerLabels="DBS,RT" style="radio"/></td>
                            <td><obs conceptId="$labTestNumber" /></td>
                            <td><obs conceptId="$hivResult"
                                     answerConceptIds="$negative,$positive,$inconclusive"
                                     answerLabels="Neg,Pos,Inc"
                                     style="radio" /></td>
                            <td><obs conceptId="$hivResultDate" /></td>

                            <td><obs conceptId="$period"/></td>
                            <td><obs conceptId="$age"/> <obs conceptId="$unitAge"/> </td>
                            <td><obs conceptId="$dateToGuardian"/></td>
                        </obsgroup>
                    </tr>
                </table>
                </td>
            </tr>
        </table>

        <!-- Remove these after migration -->
        <table class="data-entry-table">
            <tr>
                <td>
                    <table>
                        <b>Rapid Antibody Testing</b>
                        <tr>
                            <td></td>
                            <td>Sample<br/>Date</td>
                            <td>Age<br/>(mth)</td>
                            <td>HTC Serial No</td>
                            <td>Result</td>
                        </tr>
                        <tr>
                            <td>Enrolment</td>
                            <td><obs conceptId="$rapidSampleDateEnrolment" /></td>
                            <td><obs conceptId="$rapidAgeEnrolment" /></td>
                            <td><obs conceptId="$rapidHTCEnrolment" /></td>
                            <td><obs conceptId="$rapidResultEnrolment" /></td>
                        </tr>
                        <tr>
                            <td>From 12 months</td>
                            <td><obs conceptId="$rapidSampleDateOne" /></td>
                            <td><obs conceptId="$rapidAgeOne" /></td>
                            <td><obs conceptId="$rapidHTCOne" /></td>
                            <td><obs conceptId="$rapidResultOne" /></td>
                        </tr>
                        <tr>
                            <td>From 24 months</td>
                            <td><obs conceptId="$rapidSampleDateTwo" /></td>
                            <td><obs conceptId="$rapidAgeTwo" /></td>
                            <td><obs conceptId="$rapidHTCTwo" /></td>
                            <td><obs conceptId="$rapidResultTwo" /></td>
                        </tr>
                    </table>
                </td>
                <td>
                    <table>
                        <b>DNA-PCR Testing</b>
                        <tr>
                            <td colspan="2"></td>
                            <td colspan="2">Result received from lab</td>
                            <td colspan="2">Result given to guardian</td>
                        </tr>
                        <tr>
                            <td>Sample<br/>Date</td>
                            <td>Sample ID</td>
                            <td>Date</td>
                            <td>Result</td>
                            <td>Date</td>
                            <td>Age<br/>(mth)</td>
                        </tr>
                        <tr>
                            <td><obs conceptId="$dnaSampleDateEnrolment" /></td>
                            <td><obs conceptId="$dnaSampleIDEnrolment" /></td>
                            <td><obs conceptId="$dnaResultRcdDateEnrolment" /></td>
                            <td><obs conceptId="$dnaResultEnrolment" /></td>
                            <td><obs conceptId="$dnaResultGivenDateEnrolment" /></td>
                            <td><obs conceptId="$dnaAgeEnrolment" /></td>
                        </tr>
                        <tr>
                            <td><obs conceptId="$dnaSampleDateOne" /></td>
                            <td><obs conceptId="$dnaSampleIDOne" /></td>
                            <td><obs conceptId="$dnaResultRcdDateOne" /></td>
                            <td><obs conceptId="$dnaResultOne" /></td>
                            <td><obs conceptId="$dnaResultGivenDateOne" /></td>
                            <td><obs conceptId="$dnaAgeOne" /></td>
                        </tr>
                        <tr>
                            <td><obs conceptId="$dnaSampleDateTwo" /></td>
                            <td><obs conceptId="$dnaSampleIDTwo" /></td>
                            <td><obs conceptId="$dnaResultRcdDateTwo" /></td>
                            <td><obs conceptId="$dnaResultTwo" /></td>
                            <td><obs conceptId="$dnaResultGivenDateTwo" /></td>
                            <td><obs conceptId="$dnaAgeTwo" /></td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>

        <hr/>
        <h2>Initiation and outcome</h2>
        <table class="data-entry-table">
        <tr>
            <td>
                Initiation Location<br/>
                <i>For Transfer-In, location of initial encounter</i>
            </td>
            <td>
                <encounterLocation id="mastercardLocation" />
            </td>
        </tr>
        <tr>
            <td>
                Initiation Date<br/>
                <i>For Transfer-In, date of initial encounter at initiation location</i>
            </td>
            <td>
                <encounterDate />
            </td>
        </tr>
        <tr>
            <td>
                Birth Date
            </td>
            <td>
                <lookup expression="patient.birthdate"/>
            </td>
        </tr>
        <tr>
            <td>
                Birth Wgt
            </td>
            <td>
                <obs conceptId="$birthWeight" showUnits="true" />
            </td>
        </tr>
        <tr>
            <td>Current outcome</td>
            <td>
                <lookup expression="fn.currentProgramWorkflowStatus(1).state.concept.name"/>
                (<lookup expression="fn.currentProgramWorkflowStatus(1).startDate"/>)
            </td>
        </tr>
    </table>

        <ifMode mode="VIEW" include="false">
            <div id="buttons" style="margin-top:10px;">
                <button class="submitButton confirm" onclick="submitHtmlForm()">
                    <uimessage code="uicommons.save"/>
                    <i class="icon-spinner icon-spin icon-2x" style="display: none; margin-left: 10px;"></i>
                </button>
            </div>
        </ifMode>
    </div>
</htmlform>