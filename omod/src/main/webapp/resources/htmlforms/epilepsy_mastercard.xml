<htmlform formUuid="7B54FBEE-240F-430C-B751-D5ED5DEA6E5E" formName="Epilepsy eMastercard"
          formEncounterType="D8CBF1B9-EC74-4858-8764-2350E2A9925B" formVersion="1.0">

    <macros>
        diagnosisSet=PIH Malawi:8445
        chronicCareDiagnosis=PIH Malawi:3683
        diagnosisDate=PIH Malawi:6774
        epilepsyDiagnosis=PIH Malawi:155
        epilepsyFamilyHistory=PIH Malawi:8484
        mentalIllFamilyHistory=PIH Malawi:8485
        behaviorFamilyHistory=PIH Malawi:8486
        yesAnswer=PIH Malawi:1065
        noAnswer=PIH Malawi:1066
        unknown=PIH Malawi:1067
        hivStatus=PIH Malawi:3753
        hivTestDate=PIH Malawi:1837
        vdrlTest=PIH Malawi:299
        reactive=PIH Malawi:1228
        nReactive=PIH Malawi:1229
        artStartDate=PIH Malawi:2516
        tonicClonic=PIH Malawi:7100
        clonic=PIH Malawi:8503
        absenceSeiz=PIH Malawi:8504
        tonicSeiz=PIH Malawi:8505
        myoclonic=PIH Malawi:8506
        atonic=PIH Malawi:8507
        simplePartial=PIH Malawi:8508
        complexPartial=PIH Malawi:8509
        unclassifiedSeiz=PIH Malawi:8510
        headTrauma=PIH Malawi:8515
        seizureHistory=PIH Malawi:8516
        birthComplicate=PIH Malawi:8517
        neonatalInfect=PIH Malawi:8518
        delayedMile=PIH Malawi:6022
        patientPhone=PIH Malawi:1426
        symptom=PIH Malawi:1293
        guardianName=PIH Malawi:1824
        smokingHistory=PIH Malawi:1551
        inPast=PIH Malawi:1548
        lastTimeSmoking=PIH Malawi:8432
        guardianPhone=PIH Malawi:2616
        relationToPatient=PIH Malawi:1328
        agreesToFollowup=PIH Malawi:2552
        chwName=PIH Malawi:8431
        ageOnset=PIH Malawi:8403
        onsetMonth=PIH Malawi:8513
        onsetYear=PIH Malawi:8512
        occupation=PIH Malawi:1304
        civilStatus=PIH Malawi:1054
        educationLevel=PIH Malawi:1688
        medHistory=PIH Malawi:8502
        exposureGroup=PIH Malawi:8546
        exposureAns=PIH Malawi:8495
        exposureDate=PIH Malawi:8545
        smoking=PIH Malawi:8492
        alcohol=PIH Malawi:6958
        pig=PIH Malawi:3675
        tradMeds=PIH Malawi:8494
        complicationGroup=PIH Malawi:8548
        complicationAns=PIH Malawi:8514
        complicationDate=PIH Malawi:8547
        injury=PIH Malawi:148
        burn=PIH Malawi:135
        statusEpil=PIH Malawi:7721
        psychosis=PIH Malawi:219
        drugRelated=PIH Malawi:1581
        other=PIH Malawi:6408
        preIctalWarn=PIH Malawi:8520
        postIcHeadache=PIH Malawi:8521
        postIcDrows=PIH Malawi:8522
        postIcPoorConcentr=PIH Malawi:8523
        postIcPoorVerbal=PIH Malawi:8524
        postIcParal=PIH Malawi:8525
        postIcDisorient=PIH Malawi:8526
        postIcNausea=PIH Malawi:8527
        postIcMemLoss=PIH Malawi:8528
        postIcHyper=PIH Malawi:8529
        trigAlc=PIH Malawi:8531
        trigFever=PIH Malawi:8532
        trigSound=PIH Malawi:8533
        trigStress=PIH Malawi:8534
        trigSleep=PIH Malawi:8535
        trigMeds=PIH Malawi:8536
        trigMenst=PIH Malawi:8537
    </macros>

    <span style="display:none">
        <encounterProvider default="16576" /><!-- Set provider to a default as not used -->
        <span id="patientBirthdate"><lookup expression="patient.birthdate"/></span>
        <obsgroup groupingConceptId="$diagnosisSet">
                <obs conceptId="$chronicCareDiagnosis" style="checkbox"
                     answerConceptId="$epilepsyDiagnosis"
                     defaultValue="$epilepsyDiagnosis"/>
                <!-- ToDo: Set this value explicitly to encounter_datetime
                           which will make this easier for reporting.
                <obs conceptId="$diagnosisDate" defaultValue="now" />
                -->
        </obsgroup>
    </span>
    <div>
        <h4 style="font-style: italic;">
            <b>NCD Patient Card</b>
            <b style="padding-left:50px;">Epilepsy</b>
            <span style="padding-left:50px;">Version 1</span>

            <span style="padding-left:50px;">
                <b style="padding-right:10px;">
                    <encounterLocation id="mastercardLocation"/>
                    <span style="padding-left:20px;">
                        Date:
                        <encounterDate/>
                    </span>
                </b>
            </span>

            <span style="padding-left:50px;">
                <b style="padding-right:10px;">NCD Reg no:</b>
                <b>
                    <lookup complexExpression="#foreach( $id in $patientIdentifiers.get(&quot;Chronic Care Number&quot;) ) $!id #end"/>
                </b>
            </span>
        </h4>


        <table class="data-entry-table">
            <tr style="border: none;">
                <td style="vertical-align:top;">
                    <h5>
                        <b>Patient / Guardian Details</b>
                    </h5>
                    <table>
                        <tr>
                            <td>Patient Name</td>
                            <td>
                                <lookup expression="patient.personName"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Sex, DOB</td>
                            <td>
                                <span class="left-cell">
                                    <lookup expression="patient.gender"/>
                                </span>
                                <span class="right-cell">
                                    <lookup expression="patient.birthdate"/>
                                    (Age:<lookup expression="patient.age"/>)
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td>Physical Address</td>
                            <td><!-- style="height:60px;"-->
                                <lookup complexExpression="#foreach( $addr in $patient.addresses) $!addr.getAddress1() $!addr.getCityVillage() $!addr.getStateProvince() $!addr.getCountyDistrict(), #end"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Patient Phone</td>
                            <td>
                                <obs conceptId="$patientPhone" size="10"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Guardian Name</td>
                            <td>
                                <obs id="guardianNameField" conceptId="$guardianName" size="40"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Guardian Phone</td>
                            <td>
                                <obs conceptId="$guardianPhone" size="10"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Guardian relation to patient</td>
                            <td>
                                <obs conceptId="$relationToPatient" size="10"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Agrees to FUP</td>
                            <td>
                                <obs conceptId="$agreesToFollowup" style="radio" answerLabels="N,Y"
                                     answerConceptIds="$noAnswer,$yesAnswer"/>
                            </td>
                        </tr>
                        <tr>
                            <td>CHW Name</td>
                            <td>
                                <obs conceptId="$chwName"/>
                            </td>
                        </tr>
                    </table>
                </td>

                <td style="vertical-align:top;">
                    <h5>
                        <b>Seizure Type</b>
                    </h5>
                    <table>
                        <tr>
                            <repeat with="['$tonicClonic','Tonic Clonic'],
                                ['$clonic','Clonic'],
                                ['$simplePartial','Simple']">
                                <td width="10%">
                                    <obs conceptId="{0}" labelText=""
                                         style="radio" answerConceptIds="$yesAnswer,$noAnswer"
                                         answerLabels="Y,N"/>
                                </td>
                                <td>
                                    {1}
                                </td>
                            </repeat>
                        </tr>
                        <tr>
                            <repeat with="['$absenceSeiz','Absence'],
                                ['$tonicSeiz','Tonic'],
                                ['$complexPartial','Complex']">
                                <td width="10%">
                                    <obs conceptId="{0}" labelText=""
                                         style="radio" answerConceptIds="$yesAnswer,$noAnswer"
                                         answerLabels="Y,N"/>
                                </td>
                                <td>
                                    {1}
                                </td>
                            </repeat>
                        </tr>
                        <tr>
                            <repeat with="['$myoclonic','Myoclonic'],
                                ['$atonic','Atonic'],
                                ['$unclassifiedSeiz','Unclassified']">
                                <td width="10%">
                                    <obs conceptId="{0}" labelText=""
                                         style="radio" answerConceptIds="$yesAnswer,$noAnswer"
                                         answerLabels="Y,N"/>
                                </td>
                                <td>
                                    {1}
                                </td>
                            </repeat>
                        </tr>

                        <tr>
                            <!-- Family History -->
                            <td colspan="6" style="vertical-align:top;">
                                <h5>
                                    <b>Family History</b>
                                </h5>
                            </td>
                        </tr>

                        <tr class="nowrap">
                            <td rowspan="2" colspan="2">
                                <obs conceptId="$epilepsyFamilyHistory" labelText="Epilepsy"
                                     answerConceptIds="$yesAnswer,$noAnswer,$unknown" answerLabels="Y,N,UNK"/>
                                <br/>
                                <obs conceptId="$mentalIllFamilyHistory" labelText="Mental illness"
                                     answerConceptIds="$yesAnswer,$noAnswer,$unknown" answerLabels="Y,N,UNK"/>
                                <br/>
                                <obs conceptId="$behaviorFamilyHistory" labelText="Behavioral problems"
                                     answerConceptIds="$yesAnswer,$noAnswer,$unknown" answerLabels="Y,N,UNK"/>
                            </td>
                            <td class="nowrap" colspan="2">
                                <obs conceptId="$hivStatus" labelText="HIV"
                                     answerConceptIds="$reactive,$nReactive,$unknown"/>
                                <br/>
                                <obs conceptId="$hivTestDate" labelText="Date test"/>
                            </td>
                            <td colspan="2">
                                <obs conceptId="$artStartDate" labelText="ART Start Date"/>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="4">
                                <obs conceptId="$vdrlTest" labelText="VDRL"
                                     answerConceptIds="$reactive,$nReactive,$unknown"/>
                            </td>
                        </tr>

                        <tr>
                            <td colspan="6"></td>
                        </tr>

                        <tr>
                            <th style="vertical-align:top;" align="left">Outcome</th>
                            <td colspan="5">
                                <b>
                                    <lookup expression="fn.currentProgramWorkflowStatus(16).state.concept.name"/>
                                    (<lookup expression="fn.currentProgramWorkflowStatus(16).startDate"/>)
                                </b>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td colspan="2">


                    <table class="data-entry-table">
                        <tr style="border: none;">
                            <td style="vertical-align:top;" colspan="3">
                                <h5>
                                    <b>Patient History at Enrollment</b>
                                </h5>
                            </td>
                            <td style="vertical-align:top;">
                                <h5>
                                    <b>Patient Overview</b>
                                </h5>
                            </td>
                        </tr>

                        <tr>
                            <td>Date of onset
                                <i>(mm / yyyy)</i>
                            </td>
                            <td>
                                <obs conceptId="$onsetMonth" placeholder="mm"/>
                                /
                                <obs conceptId="$onsetYear" placeholder="yyyy"/>
                            </td>

                            <td style="vertical-align:top;">
                                <b>Medical &amp; Surgical History</b>
                            </td>

                            <td style="vertical-align:top;">
                                <b>Exposures</b>
                            </td>
                        </tr>
                        <tr>
                            <td>Age at onset
                                <i>(in years)</i>
                            </td>
                            <td>
                                <obs conceptId="$ageOnset"/>
                            </td>
                            <td style="vertical-align:top;" rowspan="5">
                                <table>
                                    <repeat with="['$headTrauma','Head injury, trauma, surgery'],
                ['$seizureHistory','History of seizure'],
                ['$birthComplicate','Complications at birth'],
                ['$neonatalInfect','Neonatal infection, Cerebral Malaria, Meningitis'],
                ['$delayedMile','Delayed milestone']">
                                        <tr>
                                            <td>

                                                <obs conceptId="{0}" labelText=""
                                                     style="radio" answerConceptIds="$yesAnswer,$noAnswer,$unknown"
                                                     answerLabels="Y,N,Unk"/>
                                            </td>
                                            <td>{1}</td>
                                        </tr>
                                    </repeat>
                                </table>
                            </td>

                            <td rowspan="5">
                                <table>
                                    <!-- ToDo:  Add free-text for other -->
                                    <repeat with="['$smoking','Smoking'],
                                                  ['$alcohol','Alcohol'],
                                                  ['$pig','Pigs/Pork'],
                                                  ['$tradMeds','Traditional medicine'],
                                                  ['$other','Other']">
                                        <tr>
                                            <obsgroup groupingConceptId="$exposureGroup">
                                                <td data-toggle-source="exposure-{0}" data-toggle-target="exposure-{0}-date">
                                                    <obs id="exposure-{0}" conceptId="$exposureAns" style="checkbox" answerConceptId="{0}" answerLabel="{1}"/>
                                                </td>
                                                <td>
                                                    <obs id="exposure-{0}-date" conceptId="$exposureDate"/>
                                                </td>
                                           </obsgroup>
                                        </tr>
                                    </repeat>
                                </table>
                            </td>
                        </tr>
                        <tr>
                            <td>Marital status</td>
                            <td>
                                <obs conceptId="$civilStatus"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Occupation</td>
                            <td>
                                <obs conceptId="$occupation"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Education level</td>
                            <td>
                                <obs conceptId="$educationLevel"/>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <obs conceptId="$medHistory" labelText="Medication history"/>
                            </td>
                        </tr>

                        <tr>
                            <td colspan="2"></td>
                            <td>
                                <b>Triggers</b>
                            </td>
                            <td>
                                <b>Complications</b>
                            </td>
                        </tr>

                        <tr>
                            <td colspan="2">
                                <obs conceptId="$preIctalWarn" labelText=""
                                     style="radio" answerConceptIds="$yesAnswer,$noAnswer,$unknown"
                                     answerLabels="Y,N,Unk"/>
                                &amp;nbsp;&amp;nbsp;Pre-ictal warning
                            </td>
                            <td style="vertical-align:top;" rowspan="7">
                                <table>
                                    <repeat with="['$trigAlc','Alcohol'],
                                  ['$trigFever','Fever'],
                                  ['$trigSound','Sound, light, touch'],
                                  ['$trigStress','Emotional stress, anger, boredom'],
                                  ['$trigSleep','Sleep deprivation, overtired'],
                                  ['$trigMeds','Missed medication'],
                                  ['$trigMenst','Menstruation']">
                                        <tr>
                                            <td>
                                                <obs conceptId="{0}" labelText=""
                                                     style="radio" answerConceptIds="$yesAnswer,$noAnswer,$unknown"
                                                     answerLabels="Y,N,Unk"/>
                                            </td>
                                            <td>{1}</td>
                                        </tr>
                                    </repeat>
                                </table>

                            </td>
                            <td rowspan="2">
                                <table>
                                    <repeat with="['$injury','Injuries'],
                                                  ['$burn','Burns'],
                                                  ['$statusEpil','Status epilepticus'],
                                                  ['$psychosis','Psychosis'],
                                                  ['$drugRelated','Drug related'],
                                                  ['$other','Other']">
                                        <tr>
                                            <obsgroup groupingConceptId="$complicationGroup">
                                                <td data-toggle-source="complication-{0}" data-toggle-target="complication-{0}-date">
                                                    <obs id="complication-{0}" conceptId="$complicationAns" labelText="" style="checkbox" answerConceptId="{0}" answerLabel="{1}"/>
                                                </td>
                                                <td>
                                                    <obs id="complication-{0}-date" conceptId="$complicationDate"/>
                                                </td>
                                            </obsgroup>
                                        </tr>
                                    </repeat>
                                </table>
                            </td>
                        </tr>

                        <tr>
                            <td rowspan="5" colspan="2">
                                <table>
                                    <tr>
                                        <td colspan="2">
                                            <b>Pre-ictal features</b>
                                        </td>
                                        <td>
                                            <obs conceptId="$postIcParal" labelText=""
                                                 style="radio" answerConceptIds="$yesAnswer,$noAnswer,$unknown"
                                                 answerLabels="Y,N,Unk"/>
                                        </td>
                                        <td>Paralysis</td>
                                    </tr>
                                    <tr>
                                        <repeat with="['$postIcHeadache','Headache'],['$postIcDisorient','Disorientation']">
                                            <td>
                                                <obs conceptId="{0}" labelText=""
                                                     style="radio" answerConceptIds="$yesAnswer,$noAnswer,$unknown"
                                                     answerLabels="Y,N,Unk"/>
                                            </td>
                                            <td>{1}</td>
                                        </repeat>
                                    </tr>
                                    <tr>
                                        <repeat with="['$postIcDrows','Drowsiness'],['$postIcNausea','Nausea']">
                                            <td>
                                                <obs conceptId="{0}" labelText=""
                                                     style="radio" answerConceptIds="$yesAnswer,$noAnswer,$unknown"
                                                     answerLabels="Y,N,Unk"/>
                                            </td>
                                            <td>{1}</td>
                                        </repeat>
                                    </tr>
                                    <tr>
                                        <repeat with="['$postIcPoorConcentr','Poor concentation'],['$postIcMemLoss','Memory loss']">
                                            <td>
                                                <obs conceptId="{0}" labelText=""
                                                     style="radio" answerConceptIds="$yesAnswer,$noAnswer,$unknown"
                                                     answerLabels="Y,N,Unk"/>
                                            </td>
                                            <td>{1}</td>
                                        </repeat>
                                    </tr>
                                    <tr>
                                        <repeat with="['$postIcPoorVerbal','Poor verbal or cognitive skill'],
                                              ['$postIcHyper','Hyperactivity']">
                                            <td>
                                                <obs conceptId="{0}" labelText=""
                                                     style="radio" answerConceptIds="$yesAnswer,$noAnswer,$unknown"
                                                     answerLabels="Y,N,Unk"/>
                                            </td>
                                            <td>{1}</td>
                                        </repeat>
                                    </tr>

                                </table>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>


        <ifMode mode="VIEW" include="false">
            <div id="buttons" style="margin-top:10px;">
                <button class="submitButton confirm" onclick="submitHtmlForm()">
                    <uimessage code="uicommons.save"/>
                    <i class="icon-spinner icon-spin icon-2x" style="display: none; margin-left: 10px;"></i>
                </button>
            </div>
        </ifMode>
    </div>
</htmlform>