<htmlform formUuid="F374493E-8038-4F81-AE3D-79D2D0EC4D1C" formName="Mental Health Visit"
          formEncounterType="D51F45F8-0EEA-4231-A7E9-C45D57F1CBA1" formVersion="1.0">

    <macros>
        noAnswer=PIH Malawi:1066
        yesAnswer=PIH Malawi:1065
        other=PIH Malawi:6408
        height=PIH Malawi:5090
        weight=PIH Malawi:5089

        chiefCompAnswer=PIH Malawi:8569
        depressive=PIH Malawi:8568
        elevMood=PIH Malawi:8578
        disrupt=PIH Malawi:8566
        abSpeech=PIH Malawi:8567
        delusion=PIH Malawi:8565
        hallucinate=PIH Malawi:8564
        insight=PIH Malawi:8579

        alcoholConstruct=PIH Malawi:2242
        mjConstruct=PIH Malawi:8574
        medsOtherConstruct=PIH Malawi:8576
        exposeHistory=PIH Malawi:8571
        alcoholHistory=PIH Malawi:1552
        current=PIH Malawi:1550

        pregnant=PIH Malawi:6131
        familyPlan=PIH Malawi:5271
        suicideRisk=PIH Malawi:8497
        sideEffects=PIH Malawi:2146
        drugsNow=PIH Malawi:1193
        drugSet=PIH Malawi:8501
        cpz=PIH Malawi:914
        hlp=PIH Malawi:4047
        fpz=PIH Malawi:927
        cbz=PIH Malawi:920
        sv=PIH Malawi:4060
        ris=PIH Malawi:8498
        flx=PIH Malawi:4045
        olanzapine=PIH Malawi:8582
        clozapine=PIH Malawi:8583
        trifluo=PIH Malawi:8237
        clopixol=PIH Malawi:8584
        noncodedText=PIH Malawi:8575
        clinicalImpression=PIH Malawi:1364
        nextAppt=PIH Malawi:5096
    </macros>

    <style>
        .section-container input[type="checkbox"] {
            margin: 0px 5px;    /* changed values to vertical, horizontal */
            top:5px;            /* added to offset the checkbox position to line up */
        }
    </style>

    <!-- Flowsheet table view -->
    <ifMode mode="VIEW" include="true">

        <table class="visit-table data-entry-table">
            <thead class="visit-table-header">
                <tr> <!-- Label row -->
                    <td style="padding: 1px;">Date</td>
                    <td style="padding: 1px;" >Ht</td>
                    <td style="padding: 1px;" >Wt</td>
                    <td colspan="7">Mental Status Examinations</td>
                    <td colspan="3">Current use</td>
                    <td rowspan="2" style="padding: 1px;"><small>Pregnant</small></td>
                    <td rowspan="2"><small>Family<br/>Planning</small></td>
                    <td rowspan="2"><small>Suicide risk</small></td>
                    <td rowspan="2"><small>Medication<br/>side effect</small></td>
                    <td colspan="8">Treatment Details</td>
                    <td rowspan="2"><small>Comments</small></td>
                    <td style="padding: 1px"><small>Next<br/>appointment</small></td>
                </tr>
                <tr>
                    <td><i style="font-size:.7em;padding: 1px;">day/month/year</i></td>
                    <td style="padding: 1px"><small>cm</small></td>
                    <td style="padding: 1px"><small>kg</small></td>
                    <td style="font-size:.7em;padding: 1px">Depressed<br/>mood</td>
                    <td style="font-size:.7em;padding: 1px">Elevated<br/>mood</td>
                    <td style="font-size:.7em;padding: 1px;">Disrupted<br/>behavior</td>
                    <td style="font-size:.7em;padding: 1px;">Disorganized<br/>speech</td>
                    <td style="font-size:.7em;padding: 1px;">Delusions</td>
                    <td style="font-size:.7em;padding: 1px;">Halluci-<br/>nations</td>
                    <td style="font-size:.7em;padding: 1px;">Insight</td>
                    <td style="font-size:.7em;padding: 1px;">Chamba<br/><i>Marijuana</i></td>
                    <td style="font-size:.7em;padding: 1px;">Alcohol</td>
                    <td style="font-size:.7em;padding: 1px;">Other<br/>drugs</td>

                    <!-- Using abbreviations for meds so it will fit -->
                    <td style="font-size:.7em;padding: 1px">CPZ</td>
                    <td style="font-size:.7em;padding: 1px">HLP</td>
                    <td style="font-size:.7em;padding: 1px">FPZ</td>
                    <td style="font-size:.7em;padding: 1px">CBZ</td>
                    <td style="font-size:.7em;padding: 1px">SV</td>
                    <td style="font-size:.7em;padding: 1px">RIS</td>
                    <td style="font-size:.7em;padding: 1px">FLX</td>
                    <td style="font-size:.7em;padding: 1px">Other</td>
                    <td><i style="font-size:.7em;">day/month/year</i></td>
                </tr>
            </thead>
            <tbody class="visit-table-body">
                <tr class="visit-table-row">
                    <td class="nowrap visit-date">
                        <encounterDate/>
                    </td>
                    <td style="padding: 1px;" >
                        <!-- Height -->
                        <obs conceptId="$height" id="heightInput" size="3"/>
                    </td>
                    <td style="padding: 1px;" >
                        <!-- Weight -->
                        <obs conceptId="$weight" id="weightInput" size="3"/>
                    </td>
                    <!-- ToDo: Mental status examination -->
                    <repeat with="['$depressive','Depressed mood'],
                              ['$elevMood','Elevated mood'],
                              ['$disrupt','Disruptive behavior'],
                              ['$abSpeech','Disorganized speech'],
                              ['$delusion','Delusions'],
                              ['$hallucinate','Hallucinations'],
                              ['$insight','Insight']">
                        <td>
                            <obs conceptId="$chiefCompAnswer" answerConceptId="{0}"
                                 answerLabel="Y" style="radio" />
                        </td>
                    </repeat>

                    <!-- Current use -->
                    <repeat with="['$mjConstruct','$exposeHistory','Chamba (Marijuana)'],
                                  ['$alcoholConstruct','$alcoholHistory','Alcohol'],
                                  ['$medsOtherConstruct','$exposeHistory','Other drugs']">
                        <td >
                            <obsgroup groupingConceptId="{0}">
                                <obs conceptId="{1}" style="checkbox"
                                     answerConceptId="$current" answerLabel=""/>
                            </obsgroup>
                        </td>
                    </repeat>

                    <td style="padding: 1px;" >
                        <!-- pregnant -->
                        <obs conceptId="$pregnant" style="checkbox"
                             answerConceptId="$yesAnswer" answerLabel="Y" />
                    </td>
                    <td style="padding: 1px;" >
                        <!-- Family planning -->
                        <obs conceptId="$familyPlan"
                             answerConceptIds="$yesAnswer,$noAnswer"
                             answerLabels="Y,N" style="radio" />
                    </td>
                    <td style="padding: 1px;" >
                        <!-- Suicide risk -->
                        <obs conceptId="$suicideRisk" answerConceptIds="$yesAnswer,$noAnswer"
                             answerLabels="Y,N" style="radio" />
                    </td>
                    <td style="padding: 1px;" >
                        <!-- Medication side effects -->
                        <obs conceptId="$sideEffects" style="yes_no" yesLabel="Y" noLabel="N" />
                    </td>

                    <!-- Treatment Details -->
                    <repeat with="['$cpz','Chloropromazine (CPZ)'],
                                  ['$hlp','Haloperidol (HLP)'],
                                  ['$fpz','Fluphenazine (FPZ)'],
                                  ['$cbz','Carbamazepine (CBZ)'],
                                  ['$sv','Sodium Valproate (SV)'],
                                  ['$ris','Risperidone (RIS)'],
                                  ['$flx','Fluoxetine (FLX)']">
                        <td style="padding: 1px;" >
                            <obsgroup groupingConceptId="$drugSet">
                                <obs conceptId="$drugsNow" answerConceptId="{0}"
                                     answerLabel="" style="checkbox" />
                            </obsgroup>
                        </td>
                    </repeat>
                    <td style="padding: 1px;font-size:.5em;">
                        <!-- ToDo:  Display this section.  For now it only shows
                             properly in the edit view. -->
                        <obsgroup groupingConceptId="$drugSet">
                            <obs conceptId="$drugsNow" answerConceptIds="$olanzapine"
                                 answerLabel="" style="checkbox" />
                        </obsgroup>
                        <br/>
                        <obsgroup groupingConceptId="$drugSet">
                            <obs conceptId="$drugsNow" answerConceptIds="$clozapine"
                                 answerLabel="" style="checkbox" />
                        </obsgroup>
                        <br/>
                        <obsgroup groupingConceptId="$drugSet">
                            <obs conceptId="$drugsNow" answerConceptIds="$trifluo"
                                 answerLabel="" style="checkbox" />
                        </obsgroup>
                        <br/>
                        <obsgroup groupingConceptId="$drugSet">
                            <obs conceptId="$drugsNow" answerConceptIds="$clopixol"
                                 answerLabel="" style="checkbox" />
                        </obsgroup>
                        <br/>

                        <obsgroup groupingConceptId="$drugSet">
                            <obs conceptId="$drugsNow" answerConceptId="$other"
                                 answerLabel=""  />
                            <obs conceptId="$noncodedText" />
                        </obsgroup>
                    </td>

                    <td style="padding: 1px;">
                        <!-- Comments -->
                        <obs conceptId="$clinicalImpression" />
                    </td>

                    <td style="padding: 1px;" >
                        <!-- Next appointment -->
                        <obs conceptId="$nextAppt" id="nextAppointmentDate"
                             allowFutureDates="true" />
                    </td>
                </tr>
                <tr>
                    <td colspan="28" align="left">
                        <submit />
                    </td>
                </tr>
            </tbody>
        </table>

    </ifMode>

    <!-- Data entry view -->
    <ifMode mode="VIEW" include="false">

        <div class="section-container">
        <h4 style="font-style: italic;">
            <b>Mental Health Patient Card</b>
            <span style="padding-left:50px;">Version 1</span>

            <span style="padding-left:50px;">
                <b style="padding-right:10px;">NCD Reg no: </b>
                <b>
                    <lookup complexExpression="#foreach( $id in $patientIdentifiers.get(&quot;Chronic Care Number&quot;) ) $!id #end" />
                </b>
            </span>
        </h4>

        <span style="display:none"><encounterProvider default="16576" /></span> <!-- Set provider to a default as not used -->

        <table class="visit-edit-table">
            <tr>
                <th>Visit Date</th>
                <td><encounterDate id="visitDate" size="20" default="today" /></td>
            </tr>
            <tr>
                <th>Visit Location</th>
                <td><encounterLocation id="visitLocation" /></td>
            </tr>
            <tr class="focus-field">
                <th>Height</th>
                <td><obs conceptId="$height" id="heightInput" size="3" showUnits="true"/></td>
            </tr>
            <tr class="focus-field">
                <th>Weight</th>
                <td><obs conceptId="$weight" id="weightInput" size="3" showUnits="true"/></td>
            </tr>
            <tr>
                <!-- ToDo: Mental status examination -->
                <th>Mental status examination (MSE)</th>
                <td>
                    <repeat with="['$depressive','Depressed mood'],
                                  ['$elevMood','Elevated mood'],
                                  ['$disrupt','Disruptive behavior'],
                                  ['$abSpeech','Disorganized speech'],
                                  ['$delusion','Delusions'],
                                  ['$hallucinate','Hallucinations'],
                                  ['$insight','Insight']">
                        <obs conceptId="$chiefCompAnswer" answerConceptId="{0}"
                             answerLabel="{1}" style="checkbox" /><br/>
                    </repeat>
                </td>
            </tr>
            <tr>
                <th>
                    Current use<br/>
                    Tick if yes
                </th>
                <td>
                    <repeat with="['$mjConstruct','$exposeHistory','Chamba (Marijuana)'],
                                  ['$alcoholConstruct','$alcoholHistory','Alcohol']">

                        <obsgroup groupingConceptId="{0}">
                            <obs conceptId="{1}" style="checkbox"
                                 answerConceptId="$current" answerLabel="{2}"/>
                            <br/>
                        </obsgroup>
                    </repeat>
                    <!-- Other med -->
                    <obsgroup groupingConceptId="$medsOtherConstruct">
                        <obs conceptId="$exposeHistory" style="checkbox"
                             answerConceptId="$current" answerLabel="Other drugs"
                             commentFieldLabel="(Please specify:" />)
                    </obsgroup>
                </td>
            </tr>
            <tr>
                <th>Pregnant?</th>
                <td>
                    <obs conceptId="$pregnant" style="checkbox"
                         answerConceptId="$yesAnswer" answerLabel="Yes" />
                </td>
            </tr>
            <tr>
                <th>
                    On family planning
                </th>
                <td>
                    <obs conceptId="$familyPlan" answerConceptIds="$yesAnswer,$noAnswer"
                        style="radio" />
                </td>
            </tr>
            <tr>
                <th>Suicide risk</th>
                <td>
                    <obs conceptId="$suicideRisk" answerConceptIds="$yesAnswer,$noAnswer"
                         style="radio" />
                </td>
            </tr>
            <tr>
                <th>Medication side effects</th>
                <td><obs conceptId="$sideEffects" style="yes_no" /></td>
            </tr>
            <tr>
                <th>Treatment Details</th>
                <td>
                    <!-- Only add drugname, not dose and frequency
                         but leave construct so it can easily be added later -->
                    <repeat with="['$cpz','Chloropromazine (CPZ)'],
                                  ['$hlp','Haloperidol (HLP)'],
                                  ['$fpz','Fluphenazine (FPZ)'],
                                  ['$cbz','Carbamazepine (CBZ)'],
                                  ['$sv','Sodium Valproate (SV)'],
                                  ['$ris','Risperidone (RIS)'],
                                  ['$flx','Fluoxetine (FLX)'],
                                  ['$olanzapine','Olanzapine'],
                                  ['$clozapine','Clozapine'],
                                  ['$trifluo','Trifluoperazine'],
                                  ['$clopixol','Clopixol']">
                        <obsgroup groupingConceptId="$drugSet">
                            <obs conceptId="$drugsNow" answerConceptId="{0}"
                                 answerLabel="{1}" style="checkbox" /><br/>
                        </obsgroup>
                    </repeat>
                    <obsgroup groupingConceptId="$drugSet">
                        <obs conceptId="$drugsNow" answerConceptId="$other"
                             answerLabel="Other, " style="checkbox" />
                        <obs conceptId="$noncodedText"
                            labelText="please specify:"/>
                    </obsgroup>
                </td>
            </tr>
            <tr>
                <!-- Comments -->
                <th>Comments</th>
                <td><obs conceptId="$clinicalImpression" style="textarea" cols="60"/></td>
            </tr>
            <tr>
                <!-- Next appointment -->
                <th>Next appointment</th>
                <td>
                    <obs conceptId="$nextAppt" id="appointmentDate" allowFutureDates="true" />
                </td>
            </tr>
        </table>
        <submit />
        </div>
    </ifMode>

</htmlform>